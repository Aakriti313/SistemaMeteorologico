{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Predicción Meteorológica</title>
  <style>
    /* Eliminar margenes y rellenos básicos del navegador */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      display: flex;       /* Para alinear el sidebar y el contenido lado a lado */
      height: 100vh;       /* Ocupa toda la pantalla */
      background: #f3f4f5; /* Color de fondo global */
    }

    /* SIDEBAR */
    .sidebar {
      width: 220px;              /* Ajusta el ancho del menú lateral */
      background-color: #2c3e50; /* Un color azul oscuro */
      color: #ecf0f1;            /* Texto claro */
      display: flex;
      flex-direction: column;    /* Logo arriba, links debajo */
      align-items: center;       /* Centrado horizontal de los elementos dentro */
    }

    .sidebar .logo {
      margin: 20px 0;            /* Separación arriba y abajo del logo */
    }

    .sidebar .logo img {
      max-width: 100px;          /* Ajusta el tamaño máximo del logo */
    }

    .nav-menu {
      list-style: none;          /* Quitamos viñetas */
      width: 100%;               /* Ocupa todo el ancho del sidebar */
      padding: 0;
      margin: 0;
    }

    .nav-menu li {
      width: 100%;
    }

    .nav-menu li a {
      display: block;
      padding: 10px 20px;
      color: inherit;            /* Mantiene el color de la sidebar */
      text-decoration: none;     /* Sin subrayado */
      transition: background-color 0.2s;
    }

    .nav-menu li a:hover {
      background-color: #34495e; /* Color un poco más claro al pasar el mouse */
    }

    /* CONTENIDO PRINCIPAL */
    .main-content {
      flex: 1;                   /* Ocupará todo el espacio restante a la derecha */
      padding: 20px;
      overflow-y: auto;          /* Permite scroll si el contenido es grande */
    }

    .main-content h1 {
      margin-bottom: 1rem;
    }

  </style>
</head>
<body>
  <!-- MENÚ LATERAL -->
  <div class="sidebar">
    <div class="logo">
      <!-- Ajusta la ruta al logo según tu estructura de archivos -->
      <img src="{% static 'app/logo1.png' %}" alt="Logo">
    </div>
    <ul class="nav-menu">
      <li><a href="#">Predicciones</a></li>
      <li><a href="#">Gráficas</a></li>
      <li><a href="#">Consultar Datos</a></li>
    </ul>
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="main-content">

    <div class="main-content">
      <h1>Predicción Meteorológica</h1>
      <p>Ingresa los valores para predecir el estado del clima:</p><br>
    
      <form id="prediction-form">
        {% csrf_token %}
        <label for="precipitation">Precipitación:</label>
        <input type="number" id="precipitation" name="precipitation" step="0.1" required><br><br>
    
        <label for="temp_max">Temperatura Máxima:</label>
        <input type="number" id="temp_max" name="temp_max" step="0.1" required><br><br>
    
        <label for="wind">Viento:</label>
        <input type="number" id="wind" name="wind" step="0.1" required><br><br>
    
        <label for="humidity">Humedad:</label>
        <input type="number" id="humidity" name="humidity" step="0.1" required><br><br>
    
        <label for="solar_radiation">Radiación Solar:</label>
        <input type="number" id="solar_radiation" name="solar_radiation" step="0.1" required><br><br>
    
        <label for="visibility">Visibilidad:</label>
        <input type="number" id="visibility" name="visibility" step="0.1" required><br><br>
    
        <label for="cloudiness_description">Tipo de cielo:</label>
        <select id="cloudiness_description" name="cloudiness_description">
          <option value="1">Parcialmente nublado</option>
          <option value="2">Cubierto</option>
          <option value="3">Despejado</option>
        </select><br><br>
    
        <label for="season_description">Estación:</label>
        <select id="season_description" name="season_description">
          <option value="1">Invierno</option>
          <option value="2">Spring</option>
          <option value="3">Verano</option>
          <option value="4">Autumn</option>
        </select><br><br>
    
        <button type="button" onclick="makePrediction()">Predecir</button>
      </form>
    
      <div id="result" style="margin-top: 20px;"></div>
    </div>
    
    <script>
      function getCSRFToken() {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith('csrftoken=')) {
            return cookie.substring('csrftoken='.length, cookie.length);
          }
        }
        return null;
      }
      
      async function makePrediction() {
        const form = document.getElementById('prediction-form');
        const formData = new FormData(form);
      
        const csrfToken = getCSRFToken();
      
        const response = await fetch('/predict/', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': csrfToken,  // Agrega el token CSRF aquí
          },
        });
      
        const resultDiv = document.getElementById('result');
        try {
          const result = await response.json();
          if (result.error) {
            resultDiv.innerHTML = `<p>Error: ${result.error}</p>`;
          } else {
            resultDiv.innerHTML = `<p>Predicción del clima: ${result.prediction}</p>`;
          }
        } catch (e) {
          resultDiv.innerHTML = `<p>Error inesperado: ${e.message}</p>`;
        }
      }
      
    </script>
    
  </div>
</body>
</html>
